<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Management Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="StyleSheet/Dashboard.css">
    <link rel="stylesheet" href="StyleSheet/SideBar.css">
    <style>
    #toast-container { position: fixed; top: 20px; right: 20px; z-index: 1000; }
    .toast { 
        padding: 12px 20px; border-radius: 8px; color: #fff; margin-bottom: 10px;
        display: flex; align-items: center; gap: 10px; font-family: sans-serif;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2); animation: slideIn 0.3s forwards;
    }
    .success { background: #008080; }
    .error { background: #e74c3c; }
    .info { background: #3498db; }
    @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    @keyframes fadeOut { to { opacity: 0; transform: translateY(-20px); } }
</style>
</head>
<body>
<div id="toast-container"></div>
   <div class="sidebar">
    <div class="sidebar-header">
        <div class="profile-container">
            <div class="profile-circle">
                <i class="fas fa-user-tie"></i> </div>
            <div class="profile-info">
                <h3>Admin</h3>
                <span>Authorized</span>
            </div>
        </div>
    </div>

    <ul class="nav-links">
        <li class="nav-item active">
            <a href="Dashboard.html"><i class="fas fa-chart-line"></i> Dashboard</a>
        </li>
        <li class="nav-item">
            <a href="Users.html"><i class="fas fa-users"></i> Users</a>
        </li>
        <li class="nav-item">
            <a href="Courses.html"><i class="fas fa-book"></i> Courses</a>
        </li>
        <li class="nav-item">
            <a href="Settings.html"><i class="fas fa-cog"></i> Settings</a>
        </li>
    </ul>

    <div class="sidebar-footer">
        <li class="nav-item logout">
            <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </li>
    </div>
</div>

    <div class="main-content">
        <header class="top-header">
            <h1>DASHBOARD</h1>
            <div id="liveClock" style="font-size: 1rem; color: #555; font-weight: 500; margin-top: -10px;">
            Loading date and time...
        </div>
            <div class="menu-container">
                <button class="menu-button" onclick="toggleMenu()">
                    &#9776;
                </button>
        
                <div id="myDropdown" class="dropdown-menu">
                    <a href="AttendanceManagement.html" class="active-link">Attendance Management</a>
                    <a href="AttendanceReport.html">Attendance Report</a>
                </div>
            </div>
        </header>

        <div class="stats-container">
            <div class="card">
                <h2>Late</h2>
                <p id="lateCount">0</p>
            </div>
            <div class="card">
                <h2>Absent</h2>
                <p id="absentCount">0</p>
            </div>
            <div class="card">
                <h2>Present</h2>
                <p id="presentCount">0</p>
            </div>
        </div>

        <div class="table-container">
            <div class="table-header">Student List</div>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Student ID</th>
                        <th>Year Level</th>
                        <th>Section</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="studentTableBody">
                    <!-- Data will load here from Firebase -->
                    <tr>
                        <td colspan="6" style="text-align:center;">Loading...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
<script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getDatabase, ref, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

    const firebaseConfig = {
        apiKey: "AIzaSyCSADfQpAWpCbB8Idf3Eu94kMeO-7QX4aQ",
        authDomain: "attendancesystem-cb683.firebaseapp.com",
        databaseURL: "https://attendancesystem-cb683-default-rtdb.firebaseio.com",
        projectId: "attendancesystem-cb683",
        storageBucket: "attendancesystem-cb683.appspot.com",
        messagingSenderId: "975901701661",
        appId: "1:975901701661:web:f8ccfbafd8e6c6e9c3f8f4"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    // --- NEW: TOAST NOTIFICATION UTILITY ---
    const notify = (msg, type = 'success') => {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : 'exclamation'}-circle"></i> ${msg}`;
        document.getElementById('toast-container').appendChild(toast);
        setTimeout(() => {
            toast.style.animation = 'fadeOut 0.5s forwards';
            setTimeout(() => toast.remove(), 500);
        }, 3000);
    };

    // --- AUTH OBSERVER ---
    onAuthStateChanged(auth, (user) => {
        if (!user) window.location.href = 'index.html';
    });

    // --- UPDATED: LOGOUT WITH TOAST ---
    const handleLogout = () => {
        if (confirm("Are you sure you want to log out?")) {
            signOut(auth).then(() => {
                notify("Logging out... Redirecting", "info");
                setTimeout(() => window.location.href = 'index.html', 1500);
            }).catch(err => notify(err.message, "error"));
        }
    };

    document.getElementById('logoutBtn').addEventListener('click', (e) => {
        e.preventDefault();
        handleLogout();
    });

    // --- ATTENDANCE & CLOCK LOGIC (Keeping your existing logic) ---
    function getTodayDate() {
        const d = new Date();
        return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
    }

    function loadTodayAttendance() {
        onValue(ref(db, `attendance/${getTodayDate()}`), (snap) => {
            const tbody = document.getElementById('studentTableBody');
            let [l, a, p] = [0, 0, 0];
            if (snap.exists()) {
                let html = '';
                Object.values(snap.val()).forEach(d => {
                    if (d.status === "PRESENT") p++; else if (d.status === "LATE") l++; else a++;
                    html += `<tr><td>${d.name}</td><td>${d.email || 'N/A'}</td><td>${d.studentID}</td><td>${d.yearLevel || 'N/A'}</td><td>${d.section || 'N/A'}</td><td><span class="status-${d.status.toLowerCase()}">${d.status}</span></td></tr>`;
                });
                tbody.innerHTML = html;
            } else {
                tbody.innerHTML = `<tr><td colspan="6" style="text-align:center;">No records for today.</td></tr>`;
            }
            document.getElementById('lateCount').textContent = l;
            document.getElementById('absentCount').textContent = a;
            document.getElementById('presentCount').textContent = p;
        });
    }

    function startLiveClock() {
        const el = document.getElementById('liveClock');
        setInterval(() => {
            const now = new Date();
            el.innerHTML = `${now.toLocaleDateString(undefined, {weekday:'long', year:'numeric', month:'long', day:'numeric'})} | ${now.toLocaleTimeString()}`;
        }, 1000);
    }

    // INITIALIZE
    window.toggleMenu = () => document.getElementById("myDropdown").classList.toggle("show");
    loadTodayAttendance();
    startLiveClock();
</script>
</body>

</html>





